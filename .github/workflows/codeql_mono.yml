name: FMS CodeQL Analysis

on:
  workflow_dispatch:

jobs:
  discover-projects:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: List C# Projects
      id: matrix-setup
      run: |
        # Find directories containing .csproj or .sln files
        projects=$(find . -type f \( -name "*.csproj" -o -name "*.sln" \) -exec dirname {} \; | sort -u)
        # Convert newlines to JSON array syntax for GitHub Actions matrix
        projects_json=$(echo "$projects" | jq -R . | jq -s .)
        echo 'projects_json=$projects_json' >> '$GITHUB_OUTPUT'

    outputs:
      project-paths: ${{ steps.matrix-setup.outputs.projects_json }}

  job2:
    runs-on: ubuntu-latest
    needs: discover-projects
    steps:
      - env:
          OUTPUT1: ${{ needs.discover-projects.outputs.project-paths }}
        run: echo "$OUTPUT1"


#   codeql-analysis:
#     runs-on: ubuntu-latest
#     needs: discover-projects
#     strategy:
#       matrix:
#         project-path: ${{ fromJson(needs.discover-projects.outputs.project-paths) }}

#     permissions:
#       actions: read
#       contents: read
#       security-events: write

#     steps:
#     - name: Checkout repository
#       uses: actions/checkout@v4

#     - name: Initialize CodeQL
#       uses: github/codeql-action/init@v2
#       with:
#         languages: 'csharp'

#     - name: Run Build Job for CodeQL
#       run: |
#         echo "Building project in: ${{ matrix.project-path }}"
#         dotnet build ${{ matrix.project-path }}

#     - name: Perform CodeQL Analysis
#       uses: github/codeql-action/analyze@v2
